CREATE TABLE CUSTOMER (
        CUSTOMER_ID NUMBER(3,0) GENERATED BY DEFAULT AS IDENTITY,
        DOB DATE NOT NULL,
        NAME VARCHAR2(50 CHAR) NOT NULL,
        TITLE VARCHAR2(10 CHAR),
        constraint pk_cust PRIMARY KEY (CUSTOMER_ID)
    );
    
    CREATE TABLE LOAN_PRODUCT (
        LOAN_PRODUCT_ID NUMBER(3,0),
        LOAN_PRODUCT_NAME VARCHAR2(50 CHAR) NOT NULL,
        VARIABLE_INTEREST_RATE BOOLEAN NOT NULL,
        PRIMARY KEY (LOAN_PRODUCT_ID)
    );

    CREATE TABLE LOAN (
        LOAN_ID NUMBER(3,0) GENERATED BY DEFAULT AS IDENTITY,
        CURRENT_BALANCE NUMBER(10,2) NOT NULL,
        OPENING_BALANCE NUMBER(10,2) NOT NULL,
        PAYMENT_AMOUNT NUMBER(10,2) NOT NULL,
        PAYMENT_DATE DATE NOT NULL,
        RATE NUMBER(10,2) NOT NULL,
        CUSTOMER_ID NUMBER(3,0) NOT NULL,
        LOAN_PRODUCT_ID NUMBER(3,0) NOT NULL,
        CONSTRAINT pk_loan PRIMARY KEY (LOAN_ID),
        CONSTRAINT fk_loan_cust FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID),
        CONSTRAINT fk_loan_loan_prod FOREIGN KEY (LOAN_PRODUCT_ID) REFERENCES LOAN_PRODUCT (LOAN_PRODUCT_ID)
    );

    ALTER TABLE CUSTOMER 
       ADD CONSTRAINT unique_cust UNIQUE (NAME, DOB);

    ALTER TABLE LOAN_PRODUCT 
       ADD CONSTRAINT unique_loan_prod UNIQUE (LOAN_PRODUCT_NAME);
       
       
/*       
    CREATE OR REPLACE TRIGGER loan_rate_trig
    BEFORE INSERT ON loan
    FOR EACH ROW
    
    DECLARE
        v_is_variable_rate BOOLEAN;
    BEGIN
        select lp.VARIABLE_INTEREST_RATE into v_is_variable_rate 
        from LOAN_PRODUCT lp 
        where lp.LOAN_PRODUCT_ID = :new.LOAN_PRODUCT_ID;
    
        if v_is_variable_rate = true then
            :new.rate := 5.25;
        end if;
    END;
/
       */
       

